# 实时警报功能说明

## 🚨 已添加的警报类型

系统现在支持以下实时警报类型：

### 1. **车辆低油量警报** (`low_fuel`)
- **触发条件**：车辆油量低于阈值
- **严重程度**：
  - `CRITICAL`: 油量 < 10%
  - `HIGH`: 油量 < 20%
- **包含信息**：车辆ID、司机ID、当前油量、位置

### 2. **订单延迟交付警报** (`delayed_delivery`)
- **触发条件**：订单超过预计交付时间
- **严重程度**：
  - `CRITICAL`: 延迟 > 60分钟
  - `HIGH`: 延迟 > 30分钟
  - `MEDIUM`: 延迟 < 30分钟
- **包含信息**：订单ID、客户ID、延迟时间、优先级、城市

### 3. **订单待处理超时警报** (`pending_order_timeout`)
- **触发条件**：订单创建后超过2小时未处理
- **严重程度**：`HIGH`
- **包含信息**：订单ID、客户ID、待处理时长、优先级

### 4. **高优先级订单积压警报** (`high_priority_backlog`)
- **触发条件**：高优先级订单（EXPRESS/SAME_DAY）超过10单
- **严重程度**：`HIGH`
- **包含信息**：总数量、EXPRESS数量、SAME_DAY数量

### 5. **仓库库存不足警报** (`low_inventory`)
- **触发条件**：仓库库存低于容量的10%
- **严重程度**：`HIGH`
- **包含信息**：仓库ID、仓库名称、当前库存、容量、利用率

### 6. **仓库库存接近满载警报** (`high_inventory`)
- **触发条件**：仓库库存超过容量的90%
- **严重程度**：`MEDIUM`
- **包含信息**：仓库ID、仓库名称、当前库存、容量、利用率

### 7. **车辆闲置过多警报** (`excessive_idle_vehicles`)
- **触发条件**：闲置车辆比例 > 50% 且仍有订单待处理
- **严重程度**：`MEDIUM`
- **包含信息**：闲置车辆数、总车辆数、待处理订单数

### 8. **车辆停滞警报** (`vehicle_stalled`)
- **触发条件**：车辆状态为"运输中"但速度为0
- **严重程度**：`HIGH`
- **包含信息**：车辆ID、司机ID、状态、位置

## 📡 警报推送机制

### WebSocket 实时推送
所有警报都会通过 WebSocket 实时推送到前端：
```javascript
{
  "type": "alert",
  "data": {
    "type": "low_fuel",
    "severity": "CRITICAL",
    "description": "车辆 VEH0001 油量低 (8.5%)",
    "timestamp": 1234567890000,
    "data": {
      "vehicle_id": "VEH0001",
      "fuel_level": 8.5,
      ...
    }
  }
}
```

### API 端点
可以通过 API 获取最近的警报：
```
GET /api/v1/alerts?limit=50
```

## 🎯 警报生成频率

- 警报检查每5秒执行一次
- 每次检查有20%的概率触发警报（避免警报过多）
- 系统自动保留最近100条警报

## 🎨 前端显示

前端会根据警报的严重程度显示不同的颜色：
- `CRITICAL`: 红色背景 (`#ffebee`)
- `HIGH`: 橙色背景 (`#fff3e0`)
- `MEDIUM`: 默认颜色
- `LOW`: 默认颜色

## ✅ 使用示例

### 查看所有警报
```bash
curl https://logitics.onrender.com/api/v1/alerts
```

### 查看最近的10条警报
```bash
curl https://logitics.onrender.com/api/v1/alerts?limit=10
```

## 🔧 自定义警报

您可以修改 `check_and_generate_alerts()` 函数来添加自定义的警报逻辑。警报通过 `generate_alert()` 函数生成和广播。

## 📊 警报统计

前端会实时显示警报列表，包括：
- 警报类型和描述
- 严重程度
- 生成时间
- 相关数据详情

现在您的系统已经具备了完整的实时警报功能！🎉

