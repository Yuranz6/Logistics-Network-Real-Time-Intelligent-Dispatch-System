services:
  # Dispatch Center Service (主服务)
  - type: web
    name: logistics-dispatch-center
    env: python
    region: oregon
    plan: free
    rootDir: applications/scheduler
    # Render 会自动读取 apt.txt 安装系统依赖
    # 优化构建命令以避免 metadata-generation-failed 错误
    # rootDir 已设置为 applications/scheduler，所以直接使用当前目录的 requirements.txt
    buildCommand: |
      python -m pip install --upgrade pip setuptools wheel
      # 使用最小化 requirements 文件，明确不包含 pandas
      # 如果某个包尝试安装 pandas，我们会在最后卸载它
      pip install --no-cache-dir -r requirements-minimal.txt || pip install --no-cache-dir -r requirements.txt
      # 如果 pandas 被意外安装，立即卸载
      pip uninstall -y pandas numpy scipy scikit-learn || true
      # 验证安装，确保没有 pandas
      pip list | grep -i pandas && echo "警告: 仍然检测到 pandas" || echo "✓ 确认未安装 pandas"
    startCommand: python dispatch_center.py
    envVars:
      - key: CONFLUENT_BOOTSTRAP_SERVERS
        sync: false  # 需要在 Render Dashboard 中手动设置
      - key: CONFLUENT_API_KEY
        sync: false  # 需要在 Render Dashboard 中手动设置
      - key: CONFLUENT_API_SECRET
        sync: false  # 需要在 Render Dashboard 中手动设置
      - key: PYTHON_VERSION
        value: 3.11.0

